id: http://w3id.org/ontogpt/phenopackets
name: phenopackets
title: Phenopackets Schema v2
description: >-
  A template for extracting a phenopacket, an anonymous
  phenotypic description of an individual or biosample
  with potential genes of interest and/or diagnoses.
  This template is based on the Phenopackets schema v2,
  originally defined in Protobuf. All classes are
  defined in a single schema here, with their corresponding
  module provided in a comment (e.g., core/individual).
prefixes:
  linkml: https://w3id.org/linkml/
  phenopackets_schema: http://w3id.org/ontogpt/phenopackets
see_also:
  - https://github.com/phenopackets/phenopacket-schema
keywords:
  - phenotype

default_prefix: phenopackets_schema
default_range: string

imports:
  - linkml:types
  - core

# TODO: identify which fields should not be generated
# (these are usually the identifiers, and we want be
# be sure they won't get generated by an LLM)

classes:
  Phenopacket:
    tree_root: true
    description: >-
      An anonymous phenotypic description of an individual or biosample with potential genes of interest and/or diagnoses.
      This is a bundle of high-level concepts with no specifically defined relational concepts. It is expected that the
      resources sharing the phenopackets will define and enforce their own semantics and level of requirements for included
      fields.
    attributes:
      id:
        description: An identifier specific for this phenopacket.
        range: string
        annotations:
          prompt: >-
            A unique identifier. This must be generated and may not be
            provided in the input text.
          prompt.example: "THP-1 Control1"
      subject:
        description: >-
          The individual representing the focus of this packet - e.g. the proband in rare disease cases or cancer patient
        range: Individual
        annotations:
          prompt: >-
            The individual or biosample being described in the input text.
      phenotypic_features:
        description: >-
          Phenotypic features relating to the subject of the phenopacket
        range: PhenotypicFeature
        multivalued: true
        inlined: true
        annotations:
          prompt: >-
            A semicolon-separated list of phenotypic features observed in the
            individual or biosample.
      measurements:
        description: >-
          Quantifiable measurements related to the individual
        range: Measurement
        multivalued: true
        inlined: true
        annotations:
          prompt: >-
            A semicolon-separated list of measurements taken from the individual
            or biosample.
      biosample:
        description: >-
          Biosample(s) derived from the patient or a collection of biosamples in isolation
        range: Biosample
        multivalued: true
        inlined: true
        annotations:
          prompt: >-
            The biosample from which the phenopacket was derived.
      interpretations:
        description: >-
          Interpretations of the phenopacket
        range: Interpretation
        multivalued: true
        inlined: true
        annotations:
          prompt: >-
            A semicolon-separated list of interpretations of the input text.
      diseases:
        description: >-
          Field for disease identifiers - could be used for listing either diagnosed or suspected conditions. The
          resources using these fields should define what this represents in their context.
        range: Disease
        multivalued: true
        inlined: true
        annotations:
          prompt: >-
            A semicolon-separated list of diagnosed or suspected disease
            conditions.
      medical_actions:
        description: >-
          Field for medical action identifiers - could be used for listing either performed or planned actions. The
          resources using these fields should define what this represents in their context.
        range: MedicalAction
        multivalued: true
        inlined: true
        annotations:
          prompt: >-
            A semicolon-separated list of medical actions taken or planned.
      files:
        description: >-
          Pointer to the relevant file(s) for the individual
        range: File
        multivalued: true
        inlined: true
        annotations:
          prompt: >-
            A semicolon-separated list of file identifiers specified in the
            input text.
      meta_data:
        description: >-
          Structured definitions of the resources and ontologies used within the phenopacket. REQUIRED
        range: MetaData
        required: true
        annotations:
          prompt: >-
            Additional metadata for the phenopacket.

  Family:
    description: >-
      Phenotype, sample and pedigree data required for a genomic diagnosis.
      Equivalent to the Genomics England InterpretationRequestRD
      https://github.com/genomicsengland/GelReportModels/blob/master/schemas/IDLs/org.gel.models.report.avro/5.0.0/InterpretationRequestRD.avdl
    attributes:
      id:
        description: An identifier specific for this family.
        range: string
        annotations:
          prompt: >-
            A unique identifier. This must be generated and may not be
            provided in the input text.
          prompt.example: "Fam1"
      proband:
        description: >-
          The individual representing the focus of this packet - e.g. the proband in rare disease cases or cancer patient
        range: Phenopacket
        annotations:
          prompt: >-
            The individual representing the focus of this input text,
            as a Phenopacket object.
      relatives:
        description: >-
          Individuals related in some way to the patient. For instance, the individuals may be genetically related or may
          be members of a cohort. If this field is used, then  it is expected that a pedigree will be included for
          genetically related individuals for use cases such as genomic diagnostics. If a phenopacket is being used to
          describe one member of a cohort, then in general one phenopacket will be created for each of the individuals in
          the cohort.
        range: Phenopacket
        multivalued: true
        annotations:
          prompt: >-
            A semicolon-separated list of relatives of the proband,
            as Phenopacket objects.
      consanguinous_parents:
        description: >-
          flag to indicate that the parents of the proband are consanguinous
        range: boolean
        annotations:
          prompt: >-
            Flag to indicate that the parents of the proband are consanguinous.
            This must be a boolean value - true or false.
            If unknown, do not include this field or a value for this field.
      pedigree:
        description: >-
          The pedigree defining the relations between the proband and their relatives. Pedigree.individual_id should
          map to the PhenoPacket.Individual.id
        range: Pedigree
        annotations:
          prompt: >-
            The pedigree defining the relations between the proband and their
            relatives.
      files:
        description: >-
          Pointer to the relevant file(s) for the family. These should be files relating to one or more of the family
          members e.g a multi-sample VCF. Files relating exclusively to individual phenopackets should be contained in the
          Phenopacket.
        range: File
        multivalued: true
        inlined: true
        annotations:
          prompt: >-
            A semicolon-separated list of file identifiers specified in the
            input text, relating to the family.
      meta_data:
        description: >-
          Structured definitions of the resources and ontologies used within the phenopacket. REQUIRED
        range: MetaData
        required: true
        annotations:
          prompt: >-
            Additional metadata for the phenopacket.

  Cohort:
    description: >-
      A group of individuals related in some phenotypic or genotypic aspect.
    attributes:
      id:
        description: An identifier specific for this cohort.
        range: string
        annotations:
          prompt: >-
            A unique identifier. This must be generated and may not be
            provided in the input text.
          prompt.example: "Cohort1"
      description:
        description: >-
          A description of the cohort, including the phenotypic or genotypic aspect that relates the individuals.
        range: string
        annotations:
          prompt: >-
            A description of the cohort, including the phenotypic or genotypic
            aspect that relates the individuals.
      members:
        description: >-
          Individuals in the cohort. Each individual should be described in a separate Phenopacket.
        range: Phenopacket
        multivalued: true
        annotations:
          prompt: >-
            A semicolon-separated list of individuals in the cohort,
            as Phenopacket objects.
      files:
        description: >-
          Pointer to relevant file(s) for the cohort. Files relating exclusively to individual phenopackets should be
          contained in the Phenopacket.
        range: File
        multivalued: true
        inlined: true
        annotations:
          prompt: >-
            A semicolon-separated list of file identifiers specified in the
            input text, relating to the cohort.
      meta_data:
        description: >-
          Structured definitions of the resources and ontologies used within the phenopacket. REQUIRED
        range: MetaData
        required: true
        annotations:
          prompt: >-
            Additional metadata for the phenopacket.

# core/base

  OntologyClass:
    description: >-
      A class (aka term, concept) in an ontology.
      FHIR mapping: CodeableConcept (http://www.hl7.org/fhir/datatypes.html#CodeableConcept)
      see also Coding (http://www.hl7.org/fhir/datatypes.html#Coding)
    attributes:
      id:
        description: >-
          a CURIE-style identifier e.g. HP:0100024, MP:0001284, UBERON:0001690.
          This is the primary key for the ontology class
          REQUIRED!
        range: uriorcurie
        required: true
        annotations:
          prompt: >-
            The identifier of the class in the ontology.
            Must be a CURIE.
      label:
        description: >-
          class label, aka name. E.g. "Abnormality of cardiovascular system"
        range: string
        annotations:
          prompt: >-
            The human-readable label of the class.

  ExternalReference:
    description: >-
      FHIR mapping: Reference (https://www.hl7.org/fhir/references.html)
    attributes:
      id:
        description: >-
          e.g. ISBN, PMID:123456, DOI:...,
          FHIR mapping: Reference.identifier
        range: uriorcurie
        annotations:
          prompt: >-
            The identifier of the reference.
            Must be a CURIE.
          prompt.example: PMID:123456
      reference:
        description: >-
          A full or partial URL pointing to the external reference if no commonly resolvable identifier can be used in the
          `id` field
          FHIR mapping Reference.reference
        range: string
        annotations:
          prompt: >-
            A full or partial URL pointing to the external reference.
      description:
        description: >-
          Human readable title or display string for the reference
          FHIR mapping: Reference.display
        range: string
        annotations:
          prompt: >-
            Human readable title or display string for the reference.

Evidence:
  description: >-
    FHIR mapping: Condition.evidence
    https://www.hl7.org/fhir/condition-definitions.html#Condition.evidence
  attributes:
    evidence_code:
      description: >-
        The encoded evidence type using, for example the Evidence & Conclusion
        Ontology (ECO - http://purl.obolibrary.org/obo/eco.owl)
      range: OntologyClass
    reference:
      description: >-
        FHIR mapping: Condition.evidence.detail
      range: ExternalReference

  Procedure:
    description: >-
      A clinical procedure performed on a subject. By preference a single concept to indicate both the procedure and the
      body site should be used. In cases where this is not possible, the body site should be indicated using a separate
      ontology class.
      e.g.
      {"code":{"NCIT:C51585": "Biopsy of Soft Palate"}}
      {"code":{"NCIT:C28743": "Punch Biopsy"}, "body_site":{"UBERON:0003403": "skin of forearm"}} - a punch biopsy of the skin from the forearm
      FHIR mapping: Procedure (https://www.hl7.org/fhir/procedure.html)
    attributes:
      code:
        description: >-
          FHIR mapping: Procedure.code
        range: OntologyClass
        annotations:
          prompt: >-
            The code for the procedure.
      body_site:
        description: >-
          FHIR mapping: Procedure.bodySite
        range: OntologyClass
        annotations:
          prompt: >-
            The code for the body site of the procedure.
      performed:
        description: >-
          When the procedure was performed.
        range: TimeElement
        annotations:
          prompt: >-
            The date and time the procedure was performed.

  GestationalAge:
    description: >-
      The gestational age of the individual at the time of the procedure.
    attributes:
      weeks:
        description: >-
          The gestational age in weeks.
        range: integer
        annotations:
          prompt: >-
            The gestational age in weeks. This must be an integer.
            Do not provide units or any non-integer value.
      days:
        description: >-
          The gestational age in days.
        range: integer
        annotations:
          prompt: >-
            The gestational age in days. This must be an integer.
            Do not provide units or any non-integer value.

  # TODO: use an extant LinkML type for this
  Age:
    description: >-
      See http://build.fhir.org/datatypes and http://build.fhir.org/condition-definitions.html#Condition.onset_x_
      In FHIR this is represented as a UCUM measurement - http://unitsofmeasure.org/trac/
    attributes:
      iso8601duration:
        description: >-
          The :ref:`ISO 8601<metadata_date_time>` age of this object as ISO8601
          duration or time intervals. e.g. P40Y10M05D)
        range: string
        annotations:
          prompt: >-
            The age as an ISO 8601 duration.
            Do not provide units.
          prompt.example: P40Y10M05D

  AgeRange:
    description: >-
      A range of ages.
    attributes:
      start:
        description: >-
          The minimum age in the range.
        range: Age
        annotations:
          prompt: >-
            The minimum age in the range.
            This should be an integer.
      end:
        description: >-
          The maximum age in the range.
        range: Age
        annotations:
          prompt: >-
            The maximum age in the range.
            This should be an integer.

  # TODO: in the protobuf schema the slots are
  # typed as google.protobuf.Timestamp.
  # Find an equivalent - for now this is strings
  TimeInterval:
    description: >-
      A time interval.
    attributes:
      start:
        description: >-
          The start of the time interval.
        range: string
        annotations:
          prompt: >-
            The start of the time interval.
      end:
        description: >-
          The end of the time interval.
        range: string
        annotations:
          prompt: >-
            The end of the time interval.

  # TODO: this contains a oneof in the protobuf schema
  # so that cardinality may be represented here:
  # only one of the following fields may be present
  TimeElement:
    description: >-
      A time element.
    attributes:
      gestational_age:
        range: GestationalAge
      age:
        range: Age
      age_range:
        range: AgeRange
      ontology_class:
        range: OntologyClass
      timestamp:
        # originally google.protobuf.Timestamp
        range: string
      interval:
        range: TimeInterval

  # TODO: represent mappings here
  # for now they are strings
  File:
    description: >-
      A file or set of files.
    attributes:
      uri:
        description: >-
          URI for the file e.g. file://data/genomes/file1.vcf.gz or https://opensnp.org/data/60.23andme-exome-vcf.231?1341012444
        range: string
        annotations:
          prompt: >-
            A unique resource identifier for the file.
            This may be a file path (beginning with file://) or URL.
          prompt.example: file://data/genomes/file1.vcf.gz
      individual_to_file_identifiers:
        description: >-
          A map of identifiers mapping an individual to a sample in the file. The key values must correspond to the
          Individual::id for the individuals in the message, the values must map to the samples in the file.
        range: string
        annotations:
          prompt: >-
            A map of identifiers mapping an individual to a sample in the file.
            The key values must correspond to the Individual::id for the individuals.
      file_attributes:
        description: >-
          Map of attributes describing the file. For example the File format or genome assembly would be defied here. For
          genomic data files there MUST be a 'genomeAssembly' key.
        range: string
        annotations:
          prompt: >-
            Map of attributes describing the file.

# core/biosample
# core/disease
# core/interpretation
# core/individual
# core/measurement
# core/medical_action
# core/meta_data
# core/pedigree
# core/phenotypic_feature
